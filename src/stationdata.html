<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/x-icon" href="img/favicon.ico">
        <title>DBAF - Stationsdaten</title>
        
        <!-- jQuery library -->
        <script type="text/javascript" src="dx_22.2.4/js/jquery.min.js"></script>
        <!-- DevExtreme theme -->
        <link rel="dx-theme" data-theme="generic.dark" href="dx_22.2.4/css/dx.dark.css" data-active="true">
        <!-- DevExtreme library -->
        <script type="text/javascript" src="dx_22.2.4/js/dx.all.js"></script>
        <!-- Dictionary files for German language -->
        <script type="text/javascript" src="dx_22.2.4/js/localization/dx.messages.de.js"></script>
        <!-- DBAF -->
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <script type="text/javascript" src="js/dbaf.js"></script>
        <script type="text/javascript" src="js/request.js"></script>
        <script type="text/javascript" src="js/ui.js"></script>
    </head>

    <body class="dx-viewport">
        <div class="dbaf-toolbar" id="toolbar"></div>

        <div class="dbaf-group-main">
            <!-- Übersicht der Seite -->
            <div class="dbaf-group">
                <h1>Stationsdaten</h1>
                <p>
                    In dieser Tabelle werden alle in Deutschland verfügbaren Bahnhöfe mit verschiedenen Daten angezeigt. <br>
                    Dieser gesamte Datenbestand kann nach Daten durchsucht, gefiltert und gruppiert werden.
                </p>
                <hr>
            </div>

            <!-- Anzeige aller Bahnhöfe -->
            <div class="dbaf-group">
                <div class="dbaf-grid" id="grid_stations"></div>
            </div>
        </div>
    </body>
    
    <!-- NOSCRIPT CHECK -->
    <noscript>
        JavaScript muss aktiviert sein, um diese Website nutzen zu können!
    </noscript>
        
    <script type="text/javascript">
        // Anzeige aktivieren
        $(".dbaf-toolbar").show();
        $(".dbaf-group-main").show();
    </script>
    <!-- NOSCRIPT CHECK -->

    <script type="text/javascript">
        // Grid auf maximale Größe strecken
        StickToClient("#grid_stations");

        // StationsDaten abhpolen
        let aStations = GetAllStations(FEDERALSTATE_ANY, () => {
            // Grid neuladen
            eGridStations.refresh();
        });

        // Grid für alle Stationen
        let eGridStations = $("#grid_stations").dxDataGrid({
            dataSource: aStations,
            keyExpr: "ID",
            allowColumnResizing: true,
            allowColumnReordering: true,
            filterRow: { visible: true },
            searchPanel: { visible: true },
            groupPanel: { visible: true },
            loadPanel: { enabled: true },
            grouping: {
                contextMenuEnabled: true,
                expandMode: "rowClick"
            },

            // Größe der Seiten
            pager: {
                showPageSizeSelector: true,
                allowedPageSizes: [10, 20, 50],
                showNavigationButtons: true
            },

            // Steuerungsmöglichkeiten
            toolbar: {
                items: [
                    // Gruppierung
                    "groupPanel",
                    // Option zum Ein- und Ausklappen aller Gruppierungen
                    {
                        location: "after",
                        widget: "dxButton",
                        options: {
                            text: "Alle einklappen",
                            width: 136,
                            onClick(e) {
                                // aus- bzw. einklappen
                                const expanding = e.component.option("text") == "Alle ausklappen";
                                eGridStations.option("grouping.autoExpandAll", expanding);
                                e.component.option("text", expanding ? "Alle einklappen" : "Alle ausklappen");
                            },
                        },
                    },
                    // Suche
                    "searchPanel"
                ]
            },

            // Spalten der Tabelle
            columns: [{
                dataField: "ID",
                visible: false
            }, {
                dataField: "name",
                sortOrder: "asc", // Sortierung der Bezeichnung
                caption: "Bezeichnung",
                summaryType: "count"
            }, {
                dataField: "federalState",
                caption: "Bundesland",
                groupIndex: 0, // Gruppierung nach Bundesland
                sortOrder: "asc" // Sortierung der Gruppierung
            }, {
                dataField: "city",
                caption: "Stadt"
            }, {
                dataField: "zipcode",
                caption: "Postleitzahl"
            }, {
                dataField: "street",
                caption: "Straße"
            }],
            
            // Zusammenfassung
            summary: {
                // Anzahl der Stationen anzeigen
                totalItems: [{
                    column: "name",
                    summaryType: "count"
                }],
                // Anzahl der Station in den Gruppierungen anzeigen
                groupItems: [{
                    summaryType: "count"
                }]
            }
        }).dxDataGrid("instance");
    </script>
    
    <!-- Toolbareinstellungen laden -->
    <script type="text/javascript" src="js/toolbar.js"></script>
</html>